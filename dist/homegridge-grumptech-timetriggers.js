import*as e from"node:https";import*as t from"crypto";var n={227:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(447)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},447:(e,t,n)=>{e.exports=function(e){function t(e){let n,i,o,a=null;function s(...e){if(!s.enabled)return;const r=s,i=Number(new Date),o=i-(n||i);r.diff=o,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";a++;const o=t.formatters[i];if("function"==typeof o){const t=e[a];n=o.call(r,t),e.splice(a,1),a--}return n})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=r,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o),set:e=>{a=e}}),"function"==typeof t.init&&t.init(s),s}function r(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(824),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},187:e=>{var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}p(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&p(e,"error",t,{once:!0})}(e,i)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,n,r){var i,o,a,u;if(s(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=c(e))>0&&a.length>i&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,u=l,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=l.bind(r);return i.listener=n,r.wrapFn=i,i}function h(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):m(i,i.length)}function g(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function p(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)r(c,this,t);else{var u=c.length,l=m(c,u);for(n=0;n<u;++n)r(l[n],this,t)}return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){return s(t),this.on(e,d(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,d(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,a;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return h(this,e,!0)},o.prototype.rawListeners=function(e){return h(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},o.prototype.listenerCount=g,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},284:function(e,t,n){var r,i,o;i=this,o=()=>{const e={VERSION:"1.0.12",not:{},all:{},any:{}},t=Object.prototype.toString,r=Array.prototype.slice,i=Object.prototype.hasOwnProperty,o=e=>(...t)=>!e(...r.call(t)),a=e=>(...t)=>{const n=l(t);for(const t of n)if(!e.call(null,t))return!1;return!0},s=e=>(...t)=>{const n=l(t);for(const t of n)if(e.call(null,t))return!0;return!1},c={"<":(e,t)=>e<t,"<=":(e,t)=>e<=t,">":(e,t)=>e>t,">=":(e,t)=>e>=t},u=(e,t)=>{const n=`${t}`,r=+(n.match(/\d+/)||NaN),i=n.match(/^[<>]=?|/)[0];return c[i]?c[i](e,r):e==r||r!=r},l=t=>{let n=r.call(t);return 1===n.length&&e.array(n[0])&&(n=n[0]),n};e.arguments=e=>"[object Arguments]"===t.call(e)||null!=e&&"object"==typeof e&&"callee"in e,e.array=e=>Array.isArray(e)&&"[object Array]"===t.call(e),e.boolean=e=>(!0===e||!1===e)&&new Boolean(e)instanceof Boolean&&"[object Boolean]"===t.call(e),e.char=t=>e.string(t)&&1===t.length,e.date=n=>new Date(n)instanceof Date&&e.not.nan(n)&&"[object Date]"===t.call(n),e.domNode=t=>e.object(t)&&t.nodeType>0,e.error=e=>"[object Error]"===t.call(e),e.function=e=>"[object Function]"===t.call(e)||"function"==typeof e,e.json=e=>"[object Object]"===t.call(e),e.nan=e=>Number.isNaN(e),e.null=e=>null===e,e.number=e=>new Number(e)instanceof Number&&"number"==typeof e&&Number.isFinite(e),e.object=e=>Object(e)===e,e.regexp=e=>"[object RegExp]"===t.call(e),e.sameType=(n,r)=>{const i=t.call(n);return i===t.call(r)&&("[object Number]"!==i||!e.any.nan(n,r)||e.all.nan(n,r))},e.sameType.api=["not"],e.string=e=>new String(e)instanceof String&&"string"==typeof e&&"[object String]"===t.call(e),e.undefined=e=>void 0===e,e.windowObject=e=>null!=e&&"object"==typeof e&&"setInterval"in e,e.stream=e=>null!==e&&"object"==typeof e&&"function"==typeof e.pipe,e.duplexStream=t=>e.writeableStream(t)&&e.readableStream(t),e.readableStream=t=>e.stream(t)&&!1!==t.readable&&"function"==typeof t._read&&"object"==typeof t._readableState,e.transformStream=t=>e.duplexStream(t)&&"function"==typeof t._transform,e.writeableStream=t=>e.stream(t)&&!1!==t.writable&&"function"==typeof t._write&&"object"==typeof t._writableState,e.empty=t=>{if(e.object(t)){const n=Object.getOwnPropertyNames(t).length;return!!(0===n||1===n&&e.array(t)||2===n&&e.arguments(t))}return""===t},e.map=e=>{const t=e.constructor?e.constructor+"":"";return/^function\s+Map\b/.test(t)},e.existy=e=>null!=e,e.falsy=e=>!e,e.truthy=o(e.falsy),e.above=(t,n)=>e.all.number(t,n)&&t>n,e.above.api=["not"],e.decimal=t=>e.number(t)&&t%1!=0,e.equal=(t,n)=>e.all.array(t,n)?t.length===n.length&&t.every((e=>n.includes(e))):e.all.object(t,n)?JSON.stringify(t)===JSON.stringify(n):e.all.number(t,n)?t===n&&1/t==1/n:e.all.string(t,n)||e.all.regexp(t,n)?`${t}`==`${n}`:!!e.all.boolean(t,n)&&t===n,e.equal.api=["not"],e.even=t=>e.number(t)&&t%2==0,e.finite=isFinite||(t=>e.not.infinite(t)&&e.not.nan(t)),e.infinite=e=>e===1/0||e===-1/0,e.integer=e=>Number.isInteger(e),e.negative=t=>e.number(t)&&t<0,e.odd=t=>e.number(t)&&(t%2==1||t%2==-1),e.positive=t=>e.number(t)&&t>0,e.under=(t,n)=>e.all.number(t,n)&&t<n,e.under.api=["not"],e.within=(t,n,r)=>e.all.number(t,n,r)&&t>n&&t<r,e.within.api=["not"];const d={affirmative:/^(?:1|t(?:rue)?|y(?:es)?|ok(?:ay)?)$/,alphaNumeric:/^[A-Za-z0-9]+$/,caPostalCode:/^(?!.*[DFIOQU])[A-VXY][0-9][A-Z]\s?[0-9][A-Z][0-9]$/,crawler:new RegExp("^.*("+["\\+https:\\/\\/developers.google.com\\/\\+\\/web\\/snippet\\/","ad\\smonitoring","adsbot","apex","applebot","archive.org_bot","baiduspider","bingbot","chromeheadless","cloudflare","cloudinary","crawler","curl","discordbot","duckduckbot","embedly","exabot","facebookexternalhit","facebot","flipboard","google","googlebot","gsa-crawler","gurujibot","guzzlehttp","heritrix","ia_archiver","insights","linkedinbot","ltx71","mediapartners","msnbot","odklbot","phantom\\.js","phantomjs","pingdom","pinterest","python","rtlnieuws","skypeuripreview","slackbot","slurp","spbot","telegrambot","test\\scertificate","testing","tiabot","tumblr ","twitterbot","vkshare","web\\sscraper","wget","yandexbot","whatsapp","orangebot","smtbot","qwantify","mj12bot","ahrefsbot","seznambot","panscient.com","duckduckgo-favicons-bot","uptimerobot","semrushbot","postman","dotbot","zoominfobot","ifttt","sogou","ru_bot","researchscan","nimbostratus-bot","slack-imgproxy","node-superagent","go-http-client","jersey","dataprovider.com","github-camo","dispatch","checkmarknetwork","screaming frog","whatweb","daum","netcraftsurveyagent","mojeekbot","surdotlybot","springbot"].join("|")+").*$","i"),creditCard:/^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/,dateString:/^(1[0-2]|0?[1-9])([/-])(3[01]|[12][0-9]|0?[1-9])(?:\2)(?:[0-9]{2})?[0-9]{2}$/,email:/^[a-zA-Z0-9][-_.+!#$%&'*/=?^`{|]{0,1}([a-zA-Z0-9][-_.+!#$%&'*/=?^`{|]{0,1})*[a-zA-Z0-9]@[a-zA-Z0-9][-.]{0,1}([a-zA-Z][-.]{0,1})*[a-zA-Z0-9]\.[a-zA-Z0-9]{1,}([.-]{0,1}[a-zA-Z]){0,}[a-zA-Z0-9]{0,}$/i,eppPhone:/^\+[0-9]{1,3}\.[0-9]{4,14}(?:x.+)?$/,hexadecimal:/^(?:0x)?[0-9a-fA-F]+$/,hexColor:/^#?([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,ipv4:/^(?:(?:\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.){3}(?:\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])$/,ipv6:/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,macAddress:/^([0-9a-f]{2}[-:]){5}[0-9a-f]{2}$/i,nanpPhone:/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/,socialSecurityNumber:/^(?!000|666)[0-8][0-9]{2}-?(?!00)[0-9]{2}-?(?!0000)[0-9]{4}$/,timeString:/^(2[0-3]|[01]?[0-9]):([0-5]?[0-9]):([0-5]?[0-9])$/,ukPostCode:/^[A-Z]{1,2}[0-9RCHNQ][0-9A-Z]?\s?[0-9][ABD-HJLNP-UW-Z]{2}$|^[A-Z]{2}-?[0-9]{4}$/,url:/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/i,usZipCode:/^[0-9]{5}(?:-[0-9]{4})?$/},h=(t,n)=>{e[t]=r=>e.existy(r)&&n[t].test(r)};for(const e in d)Object.prototype.hasOwnProperty.call(d,e)&&h(e,d);e.ip=t=>e.ipv4(t)||e.ipv6(t),e.capitalized=t=>{if(e.not.string(t))return!1;const n=t.split(" ");for(const e of n)if(e.length){const t=e.charAt(0);if(t!==t.toUpperCase())return!1}return!0},e.endWith=(t,n)=>{if(e.not.string(t))return!1;n+="";const r=t.length-n.length;return r>=0&&t.indexOf(n,r)===r},e.endWith.api=["not"],e.include=(e,t)=>e.includes(t),e.include.api=["not"],e.umlaut=t=>e.string(t)&&e.array(t.match(/[\u00c4\u00e4\u00d6\u00f6\u00dc\u00fc\u00df]/g)),e.lowerCase=t=>e.string(t)&&t===t.toLowerCase(),e.palindrome=t=>!e.not.string(t)&&(t=t.replace(/[^a-zA-Z0-9]+/g,"").toLowerCase()).split("").every(((e,n)=>e===t[t.length-1-n])),e.space=t=>{if(e.not.char(t))return!1;const n=t.charCodeAt(0);return n>8&&n<14||32===n},e.startWith=(t,n)=>e.string(t)&&0===t.indexOf(n),e.startWith.api=["not"],e.upperCase=t=>e.string(t)&&t===t.toUpperCase();const g=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],m=["january","february","march","april","may","june","july","august","september","october","november","december"];e.day=(t,n)=>e.date(t)&&n.toLowerCase()===g[t.getDay()],e.day.api=["not"],e.dayLightSavingTime=e=>{const t=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),6,1),r=Math.max(t.getTimezoneOffset(),n.getTimezoneOffset());return e.getTimezoneOffset()<r},e.future=t=>{const n=new Date;return e.date(t)&&t.getTime()>n.getTime()},e.inDateRange=(t,n,r)=>{if(e.not.date(t)||e.not.date(n)||e.not.date(r))return!1;const i=t.getTime();return i>n.getTime()&&i<r.getTime()},e.inDateRange.api=["not"],e.inLastMonth=t=>e.inDateRange(t,new Date((new Date).setMonth((new Date).getMonth()-1)),new Date),e.inLastWeek=t=>e.inDateRange(t,new Date((new Date).setDate((new Date).getDate()-7)),new Date),e.inLastYear=t=>e.inDateRange(t,new Date((new Date).setFullYear((new Date).getFullYear()-1)),new Date),e.inNextMonth=t=>e.inDateRange(t,new Date,new Date((new Date).setMonth((new Date).getMonth()+1))),e.inNextWeek=t=>e.inDateRange(t,new Date,new Date((new Date).setDate((new Date).getDate()+7))),e.inNextYear=t=>e.inDateRange(t,new Date,new Date((new Date).setFullYear((new Date).getFullYear()+1))),e.leapYear=t=>e.number(t)&&(t%4==0&&t%100!=0||t%400==0),e.month=(t,n)=>e.date(t)&&n.toLowerCase()===m[t.getMonth()],e.month.api=["not"],e.past=t=>{const n=new Date;return e.date(t)&&t.getTime()<n.getTime()},e.quarterOfYear=(t,n)=>e.date(t)&&e.number(n)&&n===Math.floor((t.getMonth()+3)/3),e.quarterOfYear.api=["not"],e.today=t=>{const n=(new Date).toDateString();return e.date(t)&&t.toDateString()===n},e.tomorrow=t=>{const n=new Date,r=new Date(n.setDate(n.getDate()+1)).toDateString();return e.date(t)&&t.toDateString()===r},e.weekend=t=>e.date(t)&&(6===t.getDay()||0===t.getDay()),e.weekday=o(e.weekend),e.year=(t,n)=>e.date(t)&&e.number(n)&&n===t.getFullYear(),e.year.api=["not"],e.yesterday=t=>{const n=new Date,r=new Date(n.setDate(n.getDate()-1)).toDateString();return e.date(t)&&t.toDateString()===r};const p=e.windowObject("object"==typeof n.g&&n.g)&&n.g,f=e.windowObject("object"==typeof self&&self)&&self,y=e.windowObject("object"==typeof this&&this)&&this,w=p||f||y||Function("return this")(),_=f&&f.document,b=w.is,v=f?.navigator,C=(v?.userAgentData?.platform||v?.platform||"").toLowerCase(),T=(v?.userAgent||"").toLowerCase(),S=(v?.vendor||"").toLowerCase();return e.browser=()=>"undefined"!=typeof window&&void 0!==window.document,e.browser.api=["not"],e.nodejs=()=>"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,e.nodejs.api=["not"],e.deno=()=>!1,e.deno.api=["not"],e.webworker=()=>"object"==typeof self&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,e.webworker.api=["not"],e.android=()=>/android/.test(T),e.android.api=["not"],e.androidPhone=()=>/android/.test(T)&&/mobile/.test(T),e.androidPhone.api=["not"],e.androidTablet=()=>/android/.test(T)&&!/mobile/.test(T),e.androidTablet.api=["not"],e.blackberry=()=>/blackberry/.test(T)||/bb10/.test(T),e.blackberry.api=["not"],e.chrome=t=>{const n=/google inc/.test(S)?T.match(/(?:chrome|crios)\/(\d+)/):null;return null!==n&&e.not.opera()&&u(n[1],t)},e.chrome.api=["not"],e.desktop=()=>e.not.mobile()&&e.not.tablet(),e.desktop.api=["not"],e.edge=e=>{const t=T.match(/edg(e|a|ios)?\/(\d+)/);return null!==t&&u(t[1],e)},e.edge.api=["not"],e.firefox=e=>{const t=T.match(/(?:firefox|fxios)\/(\d+)/);return null!==t&&u(t[1],e)},e.firefox.api=["not"],e.ie=e=>{const t=T.match(/(?:msie |trident.+?; rv:)(\d+)/);return null!==t&&u(t[1],e)},e.ie.api=["not"],e.ios=()=>e.iphone()||e.ipad()||e.ipod(),e.ios.api=["not"],e.ipad=e=>{const t=T.match(/\(ipad.*os (\d+)[._](\d+)/)||(T.includes("mac")&&"ontouchend"in _?T.match(/version\/(\d+)/):null);return null!==t&&u(t[1],e)},e.ipad.api=["not"],e.iphone=e=>{const t=T.match(/\(iphone.*os (\d+)[._](\d+)/);return null!==t&&u(t[1]||1,e)},e.iphone.api=["not"],e.ipod=e=>{const t=T.match(/ipod.+?os (\d+)/);return null!==t&&u(t[1],e)},e.ipod.api=["not"],e.linux=()=>/linux/.test(C)&&e.not.android(),e.linux.api=["not"],e.mac=()=>/mac/.test(C),e.mac.api=["not"],e.mobile=()=>e.iphone()||e.ipod()||e.androidPhone()||e.blackberry()||e.windowsPhone(),e.mobile.api=["not"],e.offline=o(e.online),e.offline.api=["not"],e.online=()=>!v||!0===v.onLine,e.online.api=["not"],e.opera=e=>{const t=T.match(/(?:^opera.+?version|opr)\/(\d+)/);return null!==t&&u(t[1],e)},e.opera.api=["not"],e.operaMini=e=>{const t=T.match(/opera mini\/(\d+)/);return null!==t&&u(t[1],e)},e.operaMini.api=["not"],e.phantom=e=>{const t=T.match(/phantomjs\/(\d+)/);return null!==t&&u(t[1],e)},e.phantom.api=["not"],e.safari=e=>{const t=T.match(/version\/(\d+)((?!chrome).)+?safari/);return null!==t&&u(t[1],e)},e.safari.api=["not"],e.tablet=()=>e.ipad()||e.androidTablet()||e.windowsTablet(),e.tablet.api=["not"],e.touchDevice=()=>!!_&&("ontouchstart"in f||"DocumentTouch"in f&&_ instanceof DocumentTouch),e.touchDevice.api=["not"],e.windows=()=>/win/.test(C),e.windows.api=["not"],e.windowsPhone=()=>e.windows()&&/phone/.test(T),e.windowsPhone.api=["not"],e.windowsTablet=()=>e.windows()&&e.not.windowsPhone()&&/touch/.test(T),e.windowsTablet.api=["not"],e.propertyCount=(t,n)=>{if(e.not.object(t)||e.not.number(n))return!1;let r=0;for(const e in t)if(i.call(t,e)&&++r>n)return!1;return r===n},e.propertyCount.api=["not"],e.propertyDefined=(t,n)=>e.object(t)&&e.string(n)&&n in t,e.propertyDefined.api=["not"],e.thenable=t=>e.object(t)&&"function"==typeof t.then,e.inArray=(t,n)=>!e.not.array(n)&&n.includes(t),e.inArray.api=["not"],e.sorted=(t,n)=>{if(e.not.array(t))return!1;const r=c[n]||c[">="];for(const[e]of t.entries())if(e>=1&&!r(t[e],t[e-1]))return!1;return!0},(()=>{const t=e;for(const n in t)if(i.call(t,n)&&e.function(t[n])){const r=t[n].api||["not","all","any"];for(const t of r)"not"===t&&(e.not[n]=o(e[n])),"all"===t&&(e.all[n]=a(e[n])),"any"===t&&(e.any[n]=s(e[n]))}})(),e.setNamespace=()=>(w.is=b,this),e.setRegexp=(e,t)=>{for(const n in d)i.call(d,n)&&t===n&&(d[n]=e)},e},void 0===(r=(()=>i.is=o()).call(t,n,t,e))||(e.exports=r)},824:e=>{var t=1e3,n=60*t,r=60*n,i=24*r;function o(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,a){a=a||{};var s,c,u=typeof e;if("string"===u&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(o){var a=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return 6048e5*a;case"days":case"day":case"d":return a*i;case"hours":case"hour":case"hrs":case"hr":case"h":return a*r;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(e);if("number"===u&&isFinite(e))return a.long?(s=e,(c=Math.abs(s))>=i?o(s,c,i,"day"):c>=r?o(s,c,r,"hour"):c>=n?o(s,c,n,"minute"):c>=t?o(s,c,t,"second"):s+" ms"):function(e){var o=Math.abs(e);return o>=i?Math.round(e/i)+"d":o>=r?Math.round(e/r)+"h":o>=n?Math.round(e/n)+"m":o>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={exports:{}};return n[e].call(o.exports,o,o.exports,i),o.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o={};(()=>{i.d(o,{Z:()=>B});var n=i(227),r=i(284);const a=(s={default:()=>e.default},c={},i.d(c,s),c);var s,c,u={227:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(447)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},447:(e,t,n)=>{e.exports=function(e){function t(e){let n,i,o,a=null;function s(...e){if(!s.enabled)return;const r=s,i=Number(new Date),o=i-(n||i);r.diff=o,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";a++;const o=t.formatters[i];if("function"==typeof o){const t=e[a];n=o.call(r,t),e.splice(a,1),a--}return n})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=r,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o),set:e=>{a=e}}),"function"==typeof t.init&&t.init(s),s}function r(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(824),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},187:e=>{var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}p(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&p(e,"error",t,{once:!0})}(e,i)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,n,r){var i,o,a,u;if(s(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"==typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=c(e))>0&&a.length>i&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,u=l,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=l.bind(r);return i.listener=n,r.wrapFn=i,i}function h(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):m(i,i.length)}function g(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function p(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=o[e];if(void 0===c)return!1;if("function"==typeof c)r(c,this,t);else{var u=c.length,l=m(c,u);for(n=0;n<u;++n)r(l[n],this,t)}return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){return s(t),this.on(e,d(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,d(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,a;if(s(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return h(this,e,!0)},o.prototype.rawListeners=function(e){return h(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},o.prototype.listenerCount=g,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},284:function(e,t,n){var r,i,o;i=this,o=()=>{const e={VERSION:"1.0.12",not:{},all:{},any:{}},t=Object.prototype.toString,r=Array.prototype.slice,i=Object.prototype.hasOwnProperty,o=e=>(...t)=>!e(...r.call(t)),a=e=>(...t)=>{const n=l(t);for(const t of n)if(!e.call(null,t))return!1;return!0},s=e=>(...t)=>{const n=l(t);for(const t of n)if(e.call(null,t))return!0;return!1},c={"<":(e,t)=>e<t,"<=":(e,t)=>e<=t,">":(e,t)=>e>t,">=":(e,t)=>e>=t},u=(e,t)=>{const n=`${t}`,r=+(n.match(/\d+/)||NaN),i=n.match(/^[<>]=?|/)[0];return c[i]?c[i](e,r):e==r||r!=r},l=t=>{let n=r.call(t);return 1===n.length&&e.array(n[0])&&(n=n[0]),n};e.arguments=e=>"[object Arguments]"===t.call(e)||null!=e&&"object"==typeof e&&"callee"in e,e.array=e=>Array.isArray(e)&&"[object Array]"===t.call(e),e.boolean=e=>(!0===e||!1===e)&&new Boolean(e)instanceof Boolean&&"[object Boolean]"===t.call(e),e.char=t=>e.string(t)&&1===t.length,e.date=n=>new Date(n)instanceof Date&&e.not.nan(n)&&"[object Date]"===t.call(n),e.domNode=t=>e.object(t)&&t.nodeType>0,e.error=e=>"[object Error]"===t.call(e),e.function=e=>"[object Function]"===t.call(e)||"function"==typeof e,e.json=e=>"[object Object]"===t.call(e),e.nan=e=>Number.isNaN(e),e.null=e=>null===e,e.number=e=>new Number(e)instanceof Number&&"number"==typeof e&&Number.isFinite(e),e.object=e=>Object(e)===e,e.regexp=e=>"[object RegExp]"===t.call(e),e.sameType=(n,r)=>{const i=t.call(n);return i===t.call(r)&&("[object Number]"!==i||!e.any.nan(n,r)||e.all.nan(n,r))},e.sameType.api=["not"],e.string=e=>new String(e)instanceof String&&"string"==typeof e&&"[object String]"===t.call(e),e.undefined=e=>void 0===e,e.windowObject=e=>null!=e&&"object"==typeof e&&"setInterval"in e,e.stream=e=>null!==e&&"object"==typeof e&&"function"==typeof e.pipe,e.duplexStream=t=>e.writeableStream(t)&&e.readableStream(t),e.readableStream=t=>e.stream(t)&&!1!==t.readable&&"function"==typeof t._read&&"object"==typeof t._readableState,e.transformStream=t=>e.duplexStream(t)&&"function"==typeof t._transform,e.writeableStream=t=>e.stream(t)&&!1!==t.writable&&"function"==typeof t._write&&"object"==typeof t._writableState,e.empty=t=>{if(e.object(t)){const n=Object.getOwnPropertyNames(t).length;return!!(0===n||1===n&&e.array(t)||2===n&&e.arguments(t))}return""===t},e.map=e=>{const t=e.constructor?e.constructor+"":"";return/^function\s+Map\b/.test(t)},e.existy=e=>null!=e,e.falsy=e=>!e,e.truthy=o(e.falsy),e.above=(t,n)=>e.all.number(t,n)&&t>n,e.above.api=["not"],e.decimal=t=>e.number(t)&&t%1!=0,e.equal=(t,n)=>e.all.array(t,n)?t.length===n.length&&t.every((e=>n.includes(e))):e.all.object(t,n)?JSON.stringify(t)===JSON.stringify(n):e.all.number(t,n)?t===n&&1/t==1/n:e.all.string(t,n)||e.all.regexp(t,n)?`${t}`==`${n}`:!!e.all.boolean(t,n)&&t===n,e.equal.api=["not"],e.even=t=>e.number(t)&&t%2==0,e.finite=isFinite||(t=>e.not.infinite(t)&&e.not.nan(t)),e.infinite=e=>e===1/0||e===-1/0,e.integer=e=>Number.isInteger(e),e.negative=t=>e.number(t)&&t<0,e.odd=t=>e.number(t)&&(t%2==1||t%2==-1),e.positive=t=>e.number(t)&&t>0,e.under=(t,n)=>e.all.number(t,n)&&t<n,e.under.api=["not"],e.within=(t,n,r)=>e.all.number(t,n,r)&&t>n&&t<r,e.within.api=["not"];const d={affirmative:/^(?:1|t(?:rue)?|y(?:es)?|ok(?:ay)?)$/,alphaNumeric:/^[A-Za-z0-9]+$/,caPostalCode:/^(?!.*[DFIOQU])[A-VXY][0-9][A-Z]\s?[0-9][A-Z][0-9]$/,crawler:new RegExp("^.*("+["\\+https:\\/\\/developers.google.com\\/\\+\\/web\\/snippet\\/","ad\\smonitoring","adsbot","apex","applebot","archive.org_bot","baiduspider","bingbot","chromeheadless","cloudflare","cloudinary","crawler","curl","discordbot","duckduckbot","embedly","exabot","facebookexternalhit","facebot","flipboard","google","googlebot","gsa-crawler","gurujibot","guzzlehttp","heritrix","ia_archiver","insights","linkedinbot","ltx71","mediapartners","msnbot","odklbot","phantom\\.js","phantomjs","pingdom","pinterest","python","rtlnieuws","skypeuripreview","slackbot","slurp","spbot","telegrambot","test\\scertificate","testing","tiabot","tumblr ","twitterbot","vkshare","web\\sscraper","wget","yandexbot","whatsapp","orangebot","smtbot","qwantify","mj12bot","ahrefsbot","seznambot","panscient.com","duckduckgo-favicons-bot","uptimerobot","semrushbot","postman","dotbot","zoominfobot","ifttt","sogou","ru_bot","researchscan","nimbostratus-bot","slack-imgproxy","node-superagent","go-http-client","jersey","dataprovider.com","github-camo","dispatch","checkmarknetwork","screaming frog","whatweb","daum","netcraftsurveyagent","mojeekbot","surdotlybot","springbot"].join("|")+").*$","i"),creditCard:/^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/,dateString:/^(1[0-2]|0?[1-9])([/-])(3[01]|[12][0-9]|0?[1-9])(?:\2)(?:[0-9]{2})?[0-9]{2}$/,email:/^[a-zA-Z0-9][-_.+!#$%&'*/=?^`{|]{0,1}([a-zA-Z0-9][-_.+!#$%&'*/=?^`{|]{0,1})*[a-zA-Z0-9]@[a-zA-Z0-9][-.]{0,1}([a-zA-Z][-.]{0,1})*[a-zA-Z0-9]\.[a-zA-Z0-9]{1,}([.-]{0,1}[a-zA-Z]){0,}[a-zA-Z0-9]{0,}$/i,eppPhone:/^\+[0-9]{1,3}\.[0-9]{4,14}(?:x.+)?$/,hexadecimal:/^(?:0x)?[0-9a-fA-F]+$/,hexColor:/^#?([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,ipv4:/^(?:(?:\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.){3}(?:\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])$/,ipv6:/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,macAddress:/^([0-9a-f]{2}[-:]){5}[0-9a-f]{2}$/i,nanpPhone:/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/,socialSecurityNumber:/^(?!000|666)[0-8][0-9]{2}-?(?!00)[0-9]{2}-?(?!0000)[0-9]{4}$/,timeString:/^(2[0-3]|[01]?[0-9]):([0-5]?[0-9]):([0-5]?[0-9])$/,ukPostCode:/^[A-Z]{1,2}[0-9RCHNQ][0-9A-Z]?\s?[0-9][ABD-HJLNP-UW-Z]{2}$|^[A-Z]{2}-?[0-9]{4}$/,url:/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/i,usZipCode:/^[0-9]{5}(?:-[0-9]{4})?$/},h=(t,n)=>{e[t]=r=>e.existy(r)&&n[t].test(r)};for(const e in d)Object.prototype.hasOwnProperty.call(d,e)&&h(e,d);e.ip=t=>e.ipv4(t)||e.ipv6(t),e.capitalized=t=>{if(e.not.string(t))return!1;const n=t.split(" ");for(const e of n)if(e.length){const t=e.charAt(0);if(t!==t.toUpperCase())return!1}return!0},e.endWith=(t,n)=>{if(e.not.string(t))return!1;n+="";const r=t.length-n.length;return r>=0&&t.indexOf(n,r)===r},e.endWith.api=["not"],e.include=(e,t)=>e.includes(t),e.include.api=["not"],e.umlaut=t=>e.string(t)&&e.array(t.match(/[\u00c4\u00e4\u00d6\u00f6\u00dc\u00fc\u00df]/g)),e.lowerCase=t=>e.string(t)&&t===t.toLowerCase(),e.palindrome=t=>!e.not.string(t)&&(t=t.replace(/[^a-zA-Z0-9]+/g,"").toLowerCase()).split("").every(((e,n)=>e===t[t.length-1-n])),e.space=t=>{if(e.not.char(t))return!1;const n=t.charCodeAt(0);return n>8&&n<14||32===n},e.startWith=(t,n)=>e.string(t)&&0===t.indexOf(n),e.startWith.api=["not"],e.upperCase=t=>e.string(t)&&t===t.toUpperCase();const g=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],m=["january","february","march","april","may","june","july","august","september","october","november","december"];e.day=(t,n)=>e.date(t)&&n.toLowerCase()===g[t.getDay()],e.day.api=["not"],e.dayLightSavingTime=e=>{const t=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),6,1),r=Math.max(t.getTimezoneOffset(),n.getTimezoneOffset());return e.getTimezoneOffset()<r},e.future=t=>{const n=new Date;return e.date(t)&&t.getTime()>n.getTime()},e.inDateRange=(t,n,r)=>{if(e.not.date(t)||e.not.date(n)||e.not.date(r))return!1;const i=t.getTime();return i>n.getTime()&&i<r.getTime()},e.inDateRange.api=["not"],e.inLastMonth=t=>e.inDateRange(t,new Date((new Date).setMonth((new Date).getMonth()-1)),new Date),e.inLastWeek=t=>e.inDateRange(t,new Date((new Date).setDate((new Date).getDate()-7)),new Date),e.inLastYear=t=>e.inDateRange(t,new Date((new Date).setFullYear((new Date).getFullYear()-1)),new Date),e.inNextMonth=t=>e.inDateRange(t,new Date,new Date((new Date).setMonth((new Date).getMonth()+1))),e.inNextWeek=t=>e.inDateRange(t,new Date,new Date((new Date).setDate((new Date).getDate()+7))),e.inNextYear=t=>e.inDateRange(t,new Date,new Date((new Date).setFullYear((new Date).getFullYear()+1))),e.leapYear=t=>e.number(t)&&(t%4==0&&t%100!=0||t%400==0),e.month=(t,n)=>e.date(t)&&n.toLowerCase()===m[t.getMonth()],e.month.api=["not"],e.past=t=>{const n=new Date;return e.date(t)&&t.getTime()<n.getTime()},e.quarterOfYear=(t,n)=>e.date(t)&&e.number(n)&&n===Math.floor((t.getMonth()+3)/3),e.quarterOfYear.api=["not"],e.today=t=>{const n=(new Date).toDateString();return e.date(t)&&t.toDateString()===n},e.tomorrow=t=>{const n=new Date,r=new Date(n.setDate(n.getDate()+1)).toDateString();return e.date(t)&&t.toDateString()===r},e.weekend=t=>e.date(t)&&(6===t.getDay()||0===t.getDay()),e.weekday=o(e.weekend),e.year=(t,n)=>e.date(t)&&e.number(n)&&n===t.getFullYear(),e.year.api=["not"],e.yesterday=t=>{const n=new Date,r=new Date(n.setDate(n.getDate()-1)).toDateString();return e.date(t)&&t.toDateString()===r};const p=e.windowObject("object"==typeof n.g&&n.g)&&n.g,f=e.windowObject("object"==typeof self&&self)&&self,y=e.windowObject("object"==typeof this&&this)&&this,w=p||f||y||Function("return this")(),_=f&&f.document,b=w.is,v=f?.navigator,C=(v?.userAgentData?.platform||v?.platform||"").toLowerCase(),T=(v?.userAgent||"").toLowerCase(),S=(v?.vendor||"").toLowerCase();return e.browser=()=>"undefined"!=typeof window&&void 0!==window.document,e.browser.api=["not"],e.nodejs=()=>"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,e.nodejs.api=["not"],e.deno=()=>!1,e.deno.api=["not"],e.webworker=()=>"object"==typeof self&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,e.webworker.api=["not"],e.android=()=>/android/.test(T),e.android.api=["not"],e.androidPhone=()=>/android/.test(T)&&/mobile/.test(T),e.androidPhone.api=["not"],e.androidTablet=()=>/android/.test(T)&&!/mobile/.test(T),e.androidTablet.api=["not"],e.blackberry=()=>/blackberry/.test(T)||/bb10/.test(T),e.blackberry.api=["not"],e.chrome=t=>{const n=/google inc/.test(S)?T.match(/(?:chrome|crios)\/(\d+)/):null;return null!==n&&e.not.opera()&&u(n[1],t)},e.chrome.api=["not"],e.desktop=()=>e.not.mobile()&&e.not.tablet(),e.desktop.api=["not"],e.edge=e=>{const t=T.match(/edg(e|a|ios)?\/(\d+)/);return null!==t&&u(t[1],e)},e.edge.api=["not"],e.firefox=e=>{const t=T.match(/(?:firefox|fxios)\/(\d+)/);return null!==t&&u(t[1],e)},e.firefox.api=["not"],e.ie=e=>{const t=T.match(/(?:msie |trident.+?; rv:)(\d+)/);return null!==t&&u(t[1],e)},e.ie.api=["not"],e.ios=()=>e.iphone()||e.ipad()||e.ipod(),e.ios.api=["not"],e.ipad=e=>{const t=T.match(/\(ipad.*os (\d+)[._](\d+)/)||(T.includes("mac")&&"ontouchend"in _?T.match(/version\/(\d+)/):null);return null!==t&&u(t[1],e)},e.ipad.api=["not"],e.iphone=e=>{const t=T.match(/\(iphone.*os (\d+)[._](\d+)/);return null!==t&&u(t[1]||1,e)},e.iphone.api=["not"],e.ipod=e=>{const t=T.match(/ipod.+?os (\d+)/);return null!==t&&u(t[1],e)},e.ipod.api=["not"],e.linux=()=>/linux/.test(C)&&e.not.android(),e.linux.api=["not"],e.mac=()=>/mac/.test(C),e.mac.api=["not"],e.mobile=()=>e.iphone()||e.ipod()||e.androidPhone()||e.blackberry()||e.windowsPhone(),e.mobile.api=["not"],e.offline=o(e.online),e.offline.api=["not"],e.online=()=>!v||!0===v.onLine,e.online.api=["not"],e.opera=e=>{const t=T.match(/(?:^opera.+?version|opr)\/(\d+)/);return null!==t&&u(t[1],e)},e.opera.api=["not"],e.operaMini=e=>{const t=T.match(/opera mini\/(\d+)/);return null!==t&&u(t[1],e)},e.operaMini.api=["not"],e.phantom=e=>{const t=T.match(/phantomjs\/(\d+)/);return null!==t&&u(t[1],e)},e.phantom.api=["not"],e.safari=e=>{const t=T.match(/version\/(\d+)((?!chrome).)+?safari/);return null!==t&&u(t[1],e)},e.safari.api=["not"],e.tablet=()=>e.ipad()||e.androidTablet()||e.windowsTablet(),e.tablet.api=["not"],e.touchDevice=()=>!!_&&("ontouchstart"in f||"DocumentTouch"in f&&_ instanceof DocumentTouch),e.touchDevice.api=["not"],e.windows=()=>/win/.test(C),e.windows.api=["not"],e.windowsPhone=()=>e.windows()&&/phone/.test(T),e.windowsPhone.api=["not"],e.windowsTablet=()=>e.windows()&&e.not.windowsPhone()&&/touch/.test(T),e.windowsTablet.api=["not"],e.propertyCount=(t,n)=>{if(e.not.object(t)||e.not.number(n))return!1;let r=0;for(const e in t)if(i.call(t,e)&&++r>n)return!1;return r===n},e.propertyCount.api=["not"],e.propertyDefined=(t,n)=>e.object(t)&&e.string(n)&&n in t,e.propertyDefined.api=["not"],e.thenable=t=>e.object(t)&&"function"==typeof t.then,e.inArray=(t,n)=>!e.not.array(n)&&n.includes(t),e.inArray.api=["not"],e.sorted=(t,n)=>{if(e.not.array(t))return!1;const r=c[n]||c[">="];for(const[e]of t.entries())if(e>=1&&!r(t[e],t[e-1]))return!1;return!0},(()=>{const t=e;for(const n in t)if(i.call(t,n)&&e.function(t[n])){const r=t[n].api||["not","all","any"];for(const t of r)"not"===t&&(e.not[n]=o(e[n])),"all"===t&&(e.all[n]=a(e[n])),"any"===t&&(e.any[n]=s(e[n]))}})(),e.setNamespace=()=>(w.is=b,this),e.setRegexp=(e,t)=>{for(const n in d)i.call(d,n)&&t===n&&(d[n]=e)},e},void 0===(r=(()=>i.is=o()).call(t,n,t,e))||(e.exports=r)},824:e=>{var t=1e3,n=60*t,r=60*n,i=24*r;function o(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,a){a=a||{};var s,c,u=typeof e;if("string"===u&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(o){var a=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return 6048e5*a;case"days":case"day":case"d":return a*i;case"hours":case"hour":case"hrs":case"hr":case"h":return a*r;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(e);if("number"===u&&isFinite(e))return a.long?(s=e,(c=Math.abs(s))>=i?o(s,c,i,"day"):c>=r?o(s,c,r,"hour"):c>=n?o(s,c,n,"minute"):c>=t?o(s,c,t,"second"):s+" ms"):function(e){var o=Math.abs(e);return o>=i?Math.round(e/i)+"d":o>=r?Math.round(e/r)+"h":o>=n?Math.round(e/n)+"m":o>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}}},l={};function d(e){var t=l[e];if(void 0!==t)return t.exports;var n=l[e]={exports:{}};return u[e].call(n.exports,n,n.exports,d),n.exports}d.d=(e,t)=>{for(var n in t)d.o(t,n)&&!d.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},d.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var h={};(()=>{d.d(h,{Q:()=>g,I:()=>m});var e=d(187),t=d(227),n=d(284);const r=(c={default:()=>a.default},u={},d.d(u,c),u),i=t("astro_data"),o="astronomical_data_processing",s="astronomical_data_process_complete";var c,u;class l extends e{constructor(e){super(),this._reset()}get RawData(){return this._rawData}get Valid(){return this._isValid}get APIVersion(){let e;return this.Valid&&n.not.undefined(this.RawData)&&(e=this.RawData.apiversion),e}get Type(){let e;return this.Valid&&n.not.undefined(this.RawData)&&n.not.undefined(this.RawData.geometry)&&n.string(this.RawData.geometry.type)&&(e=this.RawData.geometry.type),e}get Latitude(){let e;return this.Valid&&n.not.undefined(this.RawData)&&n.not.undefined(this.RawData.geometry)&&n.array(this.RawData.geometry.coordinates)&&n.number(this.RawData.geometry.coordinates[1])&&(e=this.RawData.geometry.coordinates[1]),e}get Longitude(){let e;return this.Valid&&n.not.undefined(this.RawData)&&n.not.undefined(this.RawData.geometry)&&n.array(this.RawData.geometry.coordinates)&&n.number(this.RawData.geometry.coordinates[0])&&(e=this.RawData.geometry.coordinates[0]),e}get Date(){const e=this._internalDate;let t;return n.not.undefined(e)&&(t=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),0,0,0,0)),t}get LunarPhase(){let e;return this.Valid&&n.not.undefined(this.RawData)&&n.not.undefined(this.RawData.properties)&&n.not.undefined(this.RawData.properties.data)&&(n.string(this.RawData.properties.data.curphase)?e=this.RawData.properties.data.curphase:n.not.undefined(this.RawData.properties.data.closestphase)&&n.string(this.RawData.properties.data.closestphase.phase)&&(e=this.RawData.properties.data.closestphase.phase)),e}get TwilightStart(){return this._getSolarPhenomenonDateTime("Begin Civil Twilight")}get TwilightEnd(){return this._getSolarPhenomenonDateTime("End Civil Twilight")}get SolarRise(){return this._getSolarPhenomenonDateTime("Rise")}get SolarSet(){return this._getSolarPhenomenonDateTime("Set")}get SolarTransit(){return this._getSolarPhenomenonDateTime("Upper Transit")}get LunarRise(){return this._getLunarPhenomenonDateTime("Rise")}get LunarSet(){return this._getLunarPhenomenonDateTime("Set")}get LunarTransit(){return this._getLunarPhenomenonDateTime("Upper Transit")}get ObjectData(){return{valid:this.Valid,version:this.APIVersion,type:this.Type,date:this.Date,latitude:this.Latitude,longitude:this.Longitude,lunar_phase:this.LunarPhase,twilight_start:this.TwilightStart,twilight_end:this.TwilightEnd,solar_rise:this.SolarRise,solar_set:this.SolarSet,solar_transit:this.SolarTransit,lunar_rise:this.LunarRise,lunar_set:this.LunarSet,lunar_transit:this.LunarTransit}}RequestAstronomicalOneDayData(e){const t="{ID}",a="{YEAR}",c="{MONTH}",u="{DAY}",d="{LATITUDE}",h="{LONGITUDE}",g=`/api/rstt/oneday?ID=${t}&date=${a}-${c}-${u}&coords=${d},${h}&tz=0`;if(!n.not.undefined(e))throw new TypeError("config is unspecified.");if(n.not.object(e))throw new TypeError("Invalid configuration.");if(n.not.undefined(e.id)&&n.not.string(e.id))throw new RangeError(`Invalid configuration. ID=${e.id}`);if(n.not.undefined(e.date)&&n.not.date(e.date))throw new RangeError(`Invalid configuration. Date=${e.date}`);l.CheckLocation(e);let m="GrmpTech";n.not.undefined(e.id)&&n.above(e.id.length,0)&&n.not.equal(e.id,"AA")&&(m=e.id.substring(0,8));let p=new Date;n.not.undefined(e.date)&&(p=e.date);const f=new Date(Date.UTC(p.getFullYear(),p.getMonth(),p.getDate()));let y=g;y=y.replace(t,m),y=y.replace(a,f.getUTCFullYear().toString()),y=y.replace(c,(f.getUTCMonth()+1).toString()),y=y.replace(u,f.getUTCDate().toString()),y=y.replace(d,e.location.latitude.toString()),y=y.replace(h,e.location.longitude.toString()),this._reset();let w,_=0,b=!1,v=!1;const C={hostname:"aa.usno.navy.mil",protocol:"https:",port:443,path:y,method:"GET",timeout:1e4};i(`${e.location.latitude},${e.location.longitude}: request`);const T=r.default.request(C,(e=>{i(`statusCode: ${e.statusCode}`),i("headers:"),i(e.headers),e.on("data",(e=>{void 0===w?w=e:w+=e,_+=e.length})),e.on("end",(()=>{try{this._rawData=JSON.parse(w.toString()),i(`Response:\n${w.toString()}`),n.not.undefined(this.RawData.error)?(i(`Response error: '${this.RawData.error}'`),v=!0):this._isValid=!0}catch(e){i("Error parsing response."),i(e),v=!0}}))}));T.on("close",(()=>{setImmediate((()=>{this.emit(o,{processing:!1})})),n.falsy(b)&&(i("No response when getting astronomical data."),v=!0),i(`${e.location.latitude},${e.location.longitude}: close - resp:${b}  err:${v}`),setImmediate((()=>{this.emit(s,{status:v})}))})),T.on("response",(()=>{i(`${e.location.latitude},${e.location.longitude}: response`),b=!0})),T.on("timeout",(()=>{i(`${e.location.latitude},${e.location.longitude}: timeout - resp:${b}`),n.falsy(b)&&T.destroy()})),T.on("error",(t=>{i(`${e.location.latitude},${e.location.longitude}: error - ${b}`),i(t),v=!0})),this.emit(o,{processing:!0}),T.end()}_reset(){this._isValid=!1,this._rawData=void 0}get _internalDate(){let e;return this.Valid&&n.not.undefined(this.RawData)&&n.not.undefined(this.RawData.properties)&&n.not.undefined(this.RawData.properties.data)&&n.not.undefined(this.RawData.properties.data.year)&&n.not.undefined(this.RawData.properties.data.month)&&n.not.undefined(this.RawData.properties.data.day)&&n.not.undefined(this.RawData.properties.data.tz)&&n.equal(this.RawData.properties.data.tz,0)&&(e=new Date(Date.UTC(this.RawData.properties.data.year,this.RawData.properties.data.month-1,this.RawData.properties.data.day,0,0,0,0))),e}_getPhenomenonDateTime(e,t){const r=this._internalDate;let i;if(n.date(r)&&n.not.undefined(e)&&n.array(e)&&n.string(t)){const o=e.find((e=>{let r=!1;return n.not.undefined(e.phen)&&n.string(e.phen)&&n.not.undefined(e.time)&&n.string(e.time)&&(r=n.equal(e.phen.toLowerCase(),t.toLowerCase())),r}));if(n.not.undefined(o)&&n.not.undefined(o.time)&&n.string(o.time)){const e=o.time.split(":");n.array(e)&&n.equal(e.length,2)&&(r.setUTCHours(Number.parseInt(e[0])),r.setUTCMinutes(Number.parseInt(e[1])),i=new Date(r))}}return i}_getSolarPhenomenonDateTime(e){let t;return n.not.undefined(this.RawData)&&n.not.undefined(this.RawData.properties)&&n.not.undefined(this.RawData.properties.data)&&n.not.undefined(this.RawData.properties.data.sundata)&&n.array(this.RawData.properties.data.sundata)&&(t=this._getPhenomenonDateTime(this.RawData.properties.data.sundata,e)),t}_getLunarPhenomenonDateTime(e){let t;return n.not.undefined(this.RawData)&&n.not.undefined(this.RawData.properties)&&n.not.undefined(this.RawData.properties.data)&&n.not.undefined(this.RawData.properties.data.moondata)&&n.array(this.RawData.properties.data.moondata)&&(t=this._getPhenomenonDateTime(this.RawData.properties.data.moondata,e)),t}static CheckLocation(e){if(n.undefined(e.location)||n.not.object(e.location)||n.not.number(e.location.latitude)||n.not.number(e.location.longitude))throw new TypeError("Invalid configuration. Location");if(n.under(e.location.latitude,-90)||n.above(e.location.latitude,90))throw new RangeError(`Invalid Location. Latitide=${e.location.latitude}`);if(n.under(e.location.longitude,-180)||n.above(e.location.longitude,180))throw new RangeError(`Invalid Location. Longatude=${e.location.longitude}`)}}t("api");const g={API_EVENT_DATA_BUSY:"busy",API_EVENT_DATA_REQUEST_COMPLETE:"request_complete"};class m extends e{constructor(){super(),this._bindDestructorNormal=this._destructor.bind(this,{cleanup:!0}),this._bindDestructorAbnormal=this._destructor.bind(this,{exit:!0}),this._astroRSTOneDay=new l,this._astroRSTOneDay.on(o,this._handleRSTDataProcessing.bind(this)),this._astroRSTOneDay.on(s,this._handleRSTDataProcessComplete.bind(this)),this._busy=!1,this._pending=!1,process.on("exit",this._bindDestructorNormal.bind(this)),process.on("uncaughtException",this._bindDestructorAbnormal.bind(this))}async _destructor(e,t){(e.exit||e.cleanup)&&(this._log.debug("Terminating the astronomical data api."),this._log.debug(t))}get Version(){return"1.1.0"}get RSTOneDayData(){let e;return n.truthy(this._astroRSTOneDay)&&(e=this._astroRSTOneDay.ObjectData),e}RequestAstronomicalOneDayData(e){if(!n.not.undefined(e))throw new TypeError("config is unspecified.");if(n.not.object(e))throw new TypeError("Invalid configuration.");if(n.not.undefined(e.id)&&n.not.string(e.id))throw new RangeError(`Invalid configuration. ID=${e.id}`);if(n.not.undefined(e.date)&&n.not.date(e.date))throw new RangeError(`Invalid configuration. Date=${e.date}`);l.CheckLocation(e),n.undefined(e.id)&&(e.id="GTAstro"),this._astroRSTOneDay.RequestAstronomicalOneDayData(e)}IsLocationValid(e){let t=!1;try{l.CheckLocation({location:e}),t=!0}finally{}return t}_handleRSTDataProcessing(e){this._pending=!1,this._busy=e.processing,setImmediate((()=>{this.emit(g.API_EVENT_DATA_BUSY,{busy:this._busy})}))}_handleRSTDataProcessComplete(e){const t={status:e.status,data:this._astroRSTOneDay.ObjectData};setImmediate((()=>{this.emit(g.API_EVENT_DATA_REQUEST_COMPLETE,t)}))}}})();var g=h.Q,m=h.I,p=i(187);const f=(e=>{var t={};return i.d(t,e),t})({createHash:()=>t.createHash,randomUUID:()=>t.randomUUID}),y={TimedTrigger:0,ScheduledTrigger:1},w={Sunday:1,Monday:2,Tuesday:4,Wednesday:8,Thursday:16,Friday:32,Saturday:64,Weekday:62,Weekend:65,AllDays:127},_="state_changed",b="state_notify",v={ASTRONOMICAL_TWILIGHT_START:"twilight_start",ASTRONOMICAL_SUNRISE:"sunrise",ASTRONOMICAL_SOALAR_TRANSIT:"solar_transit",ASTRONOMICAL_SUNSET:"sunset",ASTRONOMICAL_TWILIGHT_END:"twilight_end",ASTRONOMICAL_MOON_RISE:"moon_rise",ASTRONOMICAL_LUNAR_TRANSIT:"lunar_transit",ASTRONOMICAL_MOON_SET:"moon_set"},C=n("time_trigger_state"),T={Next:"next",Abort:"abort"};class S{constructor(e){if(r.undefined(e)||r.not.object(e)||r.undefined(e.owner)||!(e.owner instanceof F))throw new TypeError("Invalid configuration.");if(this.constructor===S)throw new Error("Instantiating base class.");this._owner=e.owner}get Name(){throw new Error("Abstract Property: Name")}get State(){throw new Error("Abstract Property: State")}get ValidTransitionStates(){throw new Error("Abstract Property: ValidTransitionStates")}Evaluate(e){if(r.not.string(e)||r.under(e.length,1)||Object.values(T).indexOf(e)<0)throw new TypeError(`'action' is invalid. ${e}`);let t=!1;switch(e){case T.Next:t=this._doNext();break;case T.Abort:t=this._doAbort();break;default:t=!1}return C(`State Eval: ${this.Name} evaluating action:${e} result:${t}`),t}OnEntrance(e){if(!(e instanceof S))throw new TypeError(`${this.Name}::OnEntrance(). oldState is invalid.`);C(`${this.Name}::OnEntrance() called. Transitioning from state ${e.Name}`)}OnExit(e){if(!(e instanceof S))throw new TypeError(`${this.Name}::OnEntrance(). newState is invalid.`);if(!this.ValidTransitionStates.includes(e.State))throw new Error(`Invalid transition from ${this.Name} to ${e.Name}`);C(`${this.Name}::OnExit() called. Transitioning to state ${e.Name}`)}_doNext(){return C(`${this.Name}::_doNext() called.`),!1}_doAbort(){return C(`${this.Name}::_doAbort() called.`),!1}}n("time_trigger_state");class D extends S{constructor(e){super(e)}get Name(){return"StateIdle"}get State(){return 0}get ValidTransitionStates(){const e=[];return e.push(0),e.push(1),e}_doNext(){let e=!1;return r.not.undefined(this._owner)&&(e=this._owner.EnterArming()),e}_doAbort(){let e=!1;return r.not.undefined(this._owner)&&(e=this._owner.EnterIdle()),e}}const E=n("time_trigger_state");class A extends S{constructor(e){super(e)}get Name(){return"StateArming"}get State(){return 1}get ValidTransitionStates(){const e=[];return e.push(0),e.push(2),e}OnEntrance(e){super.OnEntrance(e),this._owner.GenerateNewTimerValues()}_doNext(){let e=!1;return r.not.undefined(this._owner)&&(E(`${this.Name}::_doNext() called. Calling EnterArmed`),e=this._owner.EnterArmed()),e}_doAbort(){let e=!1;return r.not.undefined(this._owner)&&(E(`${this.Name}::_doAbort() called. Calling EnterIdle`),e=this._owner.EnterIdle()),e}}const O=n("time_trigger_state");class N extends S{constructor(e){super(e)}get Name(){return"StateArmed"}get State(){return 2}get ValidTransitionStates(){const e=[];return e.push(0),e.push(3),e}OnEntrance(e){super.OnEntrance(e),O(`TriggerStateArmed::OnEntrance: oldState=${e.Name} delay=${this._owner.Timeout}`),this._owner.DoStart(this._owner.Timeout)}_doNext(){let e=!1;return r.not.undefined(this._owner)&&(e=this._owner.EnterTripped()),e}_doAbort(){let e=!1;return r.not.undefined(this._owner)&&(e=this._owner.EnterIdle()),e}}const x=n("time_trigger_state");class I extends S{constructor(e){super(e)}get Name(){return"StateTripped"}get State(){return 3}get ValidTransitionStates(){const e=[];return e.push(0),e.push(1),e}OnEntrance(e){super.OnEntrance(e),x(`TriggerStateTripped::OnEntrance: oldState=${e.Name} delay=${this._owner.Duration}`),this._owner.DoStart(this._owner.Duration)}_doNext(){let e=!1;return r.not.undefined(this._owner)&&(e=this._owner.IsTripLimitExpired?this._owner.EnterIdle():this._owner.EnterArming()),e}_doAbort(){let e=!1;return r.not.undefined(this._owner)&&(e=this._owner.EnterIdle()),e}}const R=n("time_trigger"),$={nominal:1e4,tolerance:0},L={nominal:250,tolerance:0};class F extends p{constructor(e){if(r.not.undefined(e)){if(r.not.object(e))throw new TypeError("Invalid configuration.");if(r.not.undefined(e.timeout)&&F._checkRange(e.timeout),r.not.undefined(e.duration)&&F._checkRange(e.duration),r.not.undefined(e.trip_limit)){if(r.not.number(e.trip_limit))throw new TypeError("Invalid configuration - trip limit");if(r.negative(e.trip_limit))throw new RangeError("Invalid configuration - trip limit")}}if(super(),this._idleState=new D({owner:this}),this._armingState=new A({owner:this}),this._armedState=new N({owner:this}),this._trippedState=new I({owner:this}),this._currentState=this._idleState,this._CB__timerTripped=this._on_timerTripped.bind(this),this._timeoutID=-1,this._uuid=f.randomUUID({disableEntropyCache:!0}),r.existy(e)&&r.string(e.signature)&&e.signature.length>0)this._signature=e.signature,this._name=e.signature;else{const t=f.createHash("sha256");r.existy(e)?t.update(JSON.stringify(e)):t.update("No config"),this._signature=t.digest("hex").toLowerCase(),this._name=this._signature.slice(0,6)}r.undefined(e)||r.undefined(e.timeout)?this._timeout=$:this._timeout=e.timeout,r.undefined(e)||r.undefined(e.duration)?this._trippedDuration=L:this._trippedDuration=e.duration,r.undefined(e)||r.undefined(e.trip_limit)?this._tripLimit=0:this._tripLimit=e.trip_limit,this._timeout_ms=-1,this._trippedDuration_ms=-1,this._tripCount=0,this._expectedTripTime=new Date,this._initializing=!0,setImmediate((()=>{this.EnterIdle()}))}get State(){return this._currentState.State}get Identifier(){return this._uuid}get Signature(){return this._signature}get Name(){return this._name}get Timeout(){return this._timeout_ms}get Duration(){return this._trippedDuration_ms}get TimeRemaining(){const e=new Date;let t=this._expectedTripTime-e;return t<0&&(t=0),t}Start(){this._initializing?setImmediate((()=>{this.Start()})):(this._currentState instanceof D||this.Stop(),this._currentState.Evaluate(T.Next))}Stop(){this._currentState.Evaluate(T.Abort)}EnterIdle(){return this._tripCount=0,this._doStop(),this._doStateChange(this._idleState),this._initializing=!1,!0}EnterArming(){return this._doStateChange(this._armingState),setImmediate((()=>{this._currentState.Evaluate(T.Next)})),!0}EnterArmed(){return this._doStateChange(this._armedState),!0}EnterTripped(){return this._tripCount++,this._doStateChange(this._trippedState),!0}get IsTripLimitExpired(){let e=this._tripLimit>0;return e&&(e=this._tripCount>=this._tripLimit),e}GenerateNewTimerValues(){this._timeout_ms=F._getNextValue(this._timeout),this._trippedDuration_ms=F._getNextValue(this._trippedDuration),R(`New Timer Values for Trigger(${this.Name}): Timeout=${this._timeout_ms} Duration=${this._trippedDuration_ms}`)}DoStart(e){if(r.not.number(e))throw new TypeError("'timeout' is not a number");if(r.not.positive(e))throw new RangeError(`'timeout' is not positive: ${e}`);this._doStop(),this._timeoutID=setTimeout(this._CB__timerTripped,e),R(`timeTrigger::_doStart: timeoutID=${this._timeoutID} delay=${e}`),this._expectedTripTime=new Date(Date.now()+e)}_doStop(){R(`timeTrigger::_doStop: timeoutID=${this._timeoutID}`),-1!==this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=-1)}_on_timerTripped(){R(`timeTrigger::_on_timerTripped: timeoutID=${this._timeoutID}`),this._timeoutID=-1,this._currentState.Evaluate(T.Next)}_doStateChange(e){if(!(e instanceof S))throw new TypeError(`Invalid State: ${e}`);e.State!==this._currentState.State?setImmediate((()=>{try{const t=this._currentState;this._currentState.OnExit(e),this._currentState=e,this._currentState.OnEntrance(t),this.emit(_,{uuid:this.Identifier,old_state:t.State,new_state:this.State})}catch(e){R(`Illegal state transition. ${e.message}`)}})):this.emit(b,{uuid:this.Identifier,current_state:this.State})}static _checkRange(e){if(r.not.undefined(e)){if(r.not.object(e)||r.not.undefined(e.nominal)&&r.not.number(e.nominal)||r.not.undefined(e.tolerance)&&r.not.number(e.tolerance))throw new TypeError("range is invalid.");if(r.negative(e.nominal)||r.negative(e.tolerance))throw new RangeError("range is invalid.")}}static _getNextValue(e){F._checkRange(e);const t=e.nominal-e.tolerance,n=e.nominal+e.tolerance;let i=Math.floor(Math.random()*(n-t))+t;return r.negative(i)&&(i=0),i}}const j=n("scheduled_trigger");class M extends F{constructor(e){if(r.not.undefined(e)){if(r.not.object(e)||r.not.undefined(e.days)&&r.not.number(e.days))throw new TypeError("Invalid configuration.");if(r.not.undefined(e.days)&&r.not.within(e.days,w.Sunday-1,w.AllDays+1))throw new RangeError(`Invalid configuration. Days=${e.days}`);if(r.not.undefined(e.astronomical_type)&&r.not.inArray(e.astronomical_type,Object.values(v)))throw new RangeError(`Invalid configuration. Astronomical Type=${e.astronomical_type}`);if(r.not.undefined(e.astronomical_type)){const t=(new m).IsLocationValid(e.location);if(r.not.truthy(t))throw new Error("Invalid location")}M._checkTime(r.not.undefined(e.astronomical_type),e.time)}if(super(e),r.not.undefined(e)&&r.not.undefined(e.days)?this._days=e.days:this._days=w.AllDays,r.not.undefined(e)&&(this._astronomicalType=e.astronomical_type),r.not.undefined(e)&&r.not.undefined(e.time))this._time=e.time,r.undefined(this._time.nominal)&&(this._time.nominal={hour:-1,minute:-1}),r.undefined(this._time.tolerance)&&(this._time.tolerance={hour:0,minute:0});else{const e=new Date;e.setMinutes(e.getMinutes()+1),this._time={nominal:{hour:e.getHours(),minute:e.getMinutes()},tolerance:{hour:0,minute:0}}}if(r.not.undefined(e)&&r.not.undefined(this._astronomicalType)){this._location=e.location;let t=0;switch(e.time.astronomical_offset.type){case"before":t=-1;break;case"after":t=1;break;default:t=0}this._astronomicalOffset=t*(60*e.time.astronomical_offset.hour+e.time.astronomical_offset.minute),this._astroHelper=new m,this._astroHelper.on(g.API_EVENT_DATA_REQUEST_COMPLETE,this._processAstronomicalResults.bind(this))}else this._triggerDelta=this._computeTriggerTimeDelta(this._time);this._CB_checkTimeRemaining=this._on_CheckTimeRemainingTripped.bind(this),this._lastTimeRemaining=-1,this._checkTimeoutID=-1,this._remainingTimeCheckPeriod=6e4,this._lastTripTime=void 0}EnterIdle(){return this._lastTripTime=new Date(0),super.EnterIdle(),!0}EnterArming(){return r.undefined(this._astroHelper)?super.EnterArming():this._doStateChange(this._armingState),!0}EnterTripped(){return this._lastTripTime=new Date,this._clearCheck(),super.EnterTripped(),!0}GenerateNewTimerValues(){if(r.undefined(this._astroHelper))this._doGenerateNewTimerValues();else{const e=new Date;this._makeAstronomicalRequest(e)}}DoStart(e){super.DoStart(e),this._lastTimeRemaining=this.TimeRemaining,this._remainingTimeCheckPeriod=6e4,this._checkTimeoutID=setInterval(this._CB_checkTimeRemaining,this._remainingTimeCheckPeriod)}_doStop(){super._doStop(),this._clearCheck()}_clearCheck(){-1!==this._checkTimeoutID&&(clearInterval(this._checkTimeoutID),this._checkTimeoutID=-1)}_makeAstronomicalRequest(e){this._astroHelper.RequestAstronomicalOneDayData({id:"gt_trigr",date:e,location:this._location})}_processAstronomicalResults(e){if(j(`Received Astro Results. status=${e.status}`),r.undefined(e)||r.undefined(e.status)||r.truthy(e.status))r.not.undefined(this._time)&&r.not.undefined(this._time.nominal)?(j("Issue getting astro results. Defer to previous event settings."),this._triggerDelta=this._computeTriggerTimeDelta(this._time),this._doGenerateNewTimerValues(),setImmediate((()=>{this._currentState.Evaluate(T.Next)}))):this._currentState.Evaluate(T.Abort);else{const t=this._getAstroDateTime(e.data);if(e.data.valid&&r.not.undefined(t)&&(this._time.nominal.hour=t.getHours(),this._time.nominal.minute=t.getMinutes()),this.Timeout>0||r.not.undefined(t)){this._triggerDelta=this._computeTriggerTimeDelta(this._time),this._doGenerateNewTimerValues();const t=e.data.date,n=new Date(Date.now()+this._timeout.nominal);t.getFullYear()==n.getFullYear()&&t.getMonth()==n.getMonth()&&t.getDate()==n.getDate()?setImmediate((()=>{this._currentState.Evaluate(T.Next)})):(j(`Requery for trigger time: day=${n.toString()}`),setImmediate((()=>{this._makeAstronomicalRequest(n)})))}else r.not.undefined(this._time)&&r.not.undefined(this._time.nominal)?(this._triggerDelta=this._computeTriggerTimeDelta(this._time),this._doGenerateNewTimerValues(),setImmediate((()=>{this._currentState.Evaluate(T.Next)}))):this._currentState.Evaluate(T.Abort)}}_doGenerateNewTimerValues(){const e=new Date,t=e.getDay(),n=e.getDate();if(t>6)throw new RangeError(`Unexpected day. day=${t}`);let i=0;const o=[];let a=0,s=t;for(;i<=6;)0!=(1<<s&this._days)&&o.push(s),s++,s>6&&(s=0),i++;let c=new Date(e);c.setHours(this._time.nominal.hour),c.setMinutes(this._time.nominal.minute),c.setSeconds(0),c.setMilliseconds(0),c.setTime(c.getTime()-this._triggerDelta/2);const u=this._computeDeltaDays(t,o[a]);c.setDate(n+u);const l=new Date(c);if(l.setTime(l.getTime()+this._triggerDelta),c<e){let n=!1;if(l>=e?c<=this._lastTripTime&&l>=this._lastTripTime?n=!0:c=e:n=!0,r.truthy(n)){let e=0;o.length>a+1?(a+=1,e=this._computeDeltaDays(t,o[a])):e=7,c.setDate(c.getDate()+e),l.setDate(l.getDate()+e)}}const d=c-e,h=(l-e-d)/2;let g=d+h;g<0&&g+h>=0&&(g=0),this._timeout={nominal:g,tolerance:h},super.GenerateNewTimerValues()}_computeDeltaDays(e,t){if(r.not.number(e)||r.not.number(t))throw new TypeError("Invalid day of week.");if(r.not.within(e,-1,7)||r.not.within(t,-1,7))throw new ReferenceError("Invalid day of week.");let n=0;return n=t>=e?t-e:6-e+(t-0)+1,n}_computeTriggerTimeDelta(e){const t=new Date;t.setHours(e.nominal.hour),t.setMinutes(e.nominal.minute),t.setSeconds(0),t.setMilliseconds(0);const n=new Date(t);n.setHours(n.getHours()-e.tolerance.hour),n.setMinutes(n.getMinutes()-e.tolerance.minute);const r=new Date(t);r.setHours(r.getHours()+e.tolerance.hour),r.setMinutes(r.getMinutes()+e.tolerance.minute),r<n&&r.setDate(r.getDate()+1);const i=r-n;return j(`Trigger delta in milliseconds: ${i}`),i}_getAstroDateTime(e){let t;if(r.not.undefined(e)&&r.not.undefined(this._astronomicalType)&&r.truthy(e.valid))switch(this._astronomicalType){case v.ASTRONOMICAL_LUNAR_TRANSIT:t=e.lunar_transit;break;case v.ASTRONOMICAL_MOON_RISE:t=e.lunar_rise;break;case v.ASTRONOMICAL_MOON_SET:t=e.lunar_set;break;case v.ASTRONOMICAL_SOALAR_TRANSIT:t=e.solar_transit;break;case v.ASTRONOMICAL_SUNRISE:t=e.solar_rise;break;case v.ASTRONOMICAL_SUNSET:t=e.solar_set;break;case v.ASTRONOMICAL_TWILIGHT_START:t=e.twilight_start;break;case v.ASTRONOMICAL_TWILIGHT_END:t=e.twilight_end}return r.not.undefined(t)&&r.not.undefined(this._astronomicalOffset)&&t.setMinutes(t.getMinutes()+this._astronomicalOffset),t}_on_CheckTimeRemainingTripped(){const e=this.TimeRemaining,t=this._lastTimeRemaining-this._remainingTimeCheckPeriod;this._lastTimeRemaining=e,r.not.negative(e)&&r.not.negative(t)&&r.above(Math.abs(e-t),500)&&(j(`Remaining time out of spec: Actual=${e} Expected=${t}`),e<=0?(this._doStop(),setImmediate((()=>{j("Forcing 'Next' state change"),this._currentState.Evaluate(T.Next)}))):(j(`Resetting timer to ${t}`),this.DoStart(t),this._doStateChange(this._currentState)))}static _checkTime(e,t){if(r.not.undefined(t)){if(r.not.object(t)||r.not.boolean(e)||r.truthy(e)&&(r.not.object(t.astronomical_offset)||r.not.number(t.astronomical_offset.hour)||r.not.number(t.astronomical_offset.minute))||r.not.object(t.nominal)||r.not.number(t.nominal.hour)||r.not.number(t.nominal.minute)||r.not.object(t.tolerance)||r.not.number(t.tolerance.hour)||r.not.number(t.tolerance.minute))throw new TypeError("time is invalid.");if(r.truthy(e)&&(r.not.within(t.astronomical_offset.hour,-1,24)||r.not.within(t.astronomical_offset.minute,-1,60))||r.not.within(t.nominal.hour,-1,24)||r.not.within(t.nominal.minute,-1,60)||r.not.within(t.tolerance.hour,-1,24)||r.not.within(t.tolerance.minute,-1,60))throw new RangeError("range is invalid.")}}}const k=1.1,P=n("homebridge"),U="homebridge-grumptech-timetriggers",z="GrumpTechHomebridgeTimeTrigger";let V,G;const Z={CONTROL:{uuid:"4A11F55C-B51E-4E17-9170-7295B0731F67",name:"Trigger Control",udst:"TriggerControl"},MOTION:{uuid:"26BCECB8-5477-4198-83F0-768F79CC2951",name:"Motion Status",udst:"MotionStatus"},DUE_TIME:{uuid:"f9ff7190-4bba-4079-86ce-acca24870921",name:"Due Time",udst:"DueTime"},TIME_REMAINING:{uuid:"168456ad-4f4b-45ac-8299-aaa080cb13cc",name:"Time Remainng Status",udst:"TimeRemainingStatus"}};class Y{constructor(e,t,n){if(this._log=e,this._config=t,this._api=n,this._name=this._config.name,this._bindDoInitialization=this._doInitialization.bind(this),this._bindDestructorNormal=this._destructor.bind(this,{cleanup:!0}),this._bindDestructorAbnormal=this._destructor.bind(this,{exit:!0}),this._CB_TriggerStateChanged=this._handleTriggerStateChanged.bind(this),this._CB_TriggerStateNotify=this._handleTriggerStateNotify.bind(this),this._log("Creating TimeTriggerPlatform"),this._triggers=new Map,!(r.not.undefined(t)&&r.not.undefined(t.settings)&&r.not.undefined(t.settings.triggers)&&r.array(t.settings.triggers)))throw new TypeError("Configuration is invalid.");t.settings.triggers.forEach(((e,t)=>{let n=null;r.not.undefined(e.trigger_identifier)&&r.string(e.trigger_identifier)&&e.trigger_identifier.length>0&&(n=e.trigger_identifier);let i=!1;if(this._triggers.forEach(((e,t)=>{r.existy(e.trigger)&&r.equal(e.trigger.Signature,n)&&(i=!0)})),i)this.log(`Trigger Identifier '${n}' already used.`);else{let t=-1;if(!(r.not.undefined(e.trigger_type)&&r.number(e.trigger_type)&&Object.values(y).indexOf(e.trigger_type)>=0))throw new TypeError("Configuration is invalid. Trigger Type.");t=e.trigger_type;const i={signature:n,trip_limit:0};switch(r.not.undefined(e.trip_limit)&&r.number(e.trip_limit)&&r.positive(e.trip_limit)&&(i.trip_limit=e.trip_limit),i.duration={nominal:250,tolerance:0},r.not.undefined(e.duration)&&r.object(e.duration)&&(r.not.undefined(e.duration.nominal)&&r.number(e.duration.nominal)&&r.positive(e.duration.nominal)&&r.above(e.duration.nominal,249)&&(i.duration.nominal=e.duration.nominal),r.not.undefined(e.duration.tolerance)&&r.number(e.duration.tolerance)&&r.not.negative(e.duration.tolerance)&&(i.duration.tolerance=e.duration.tolerance)),t){case y.TimedTrigger:i.timeout={nominal:6e4,tolerance:0},r.not.undefined(e.timeout)&&r.object(e.timeout)&&(r.not.undefined(e.timeout.nominal)&&r.number(e.timeout.nominal)&&r.positive(e.timeout.nominal)&&(i.timeout.nominal=e.timeout.nominal),r.not.undefined(e.timeout.tolerance)&&r.number(e.timeout.tolerance)&&r.not.negative(e.timeout.tolerance)&&(i.timeout.tolerance=e.timeout.tolerance));break;case y.ScheduledTrigger:if(i.days=w.AllDays,r.not.undefined(e.days)&&r.number(e.days)&&Object.values(w).indexOf(e.days)>=0&&(i.days=e.days),r.not.undefined(e.is_astronomical)&&r.boolean(e.is_astronomical)&&r.not.undefined(e.astronomical_type)&&r.string(e.astronomical_type)&&e.is_astronomical&&(i.astronomical_type=e.astronomical_type),r.not.undefined(i.astronomical_type)&&(i.location={latitude:0,longitude:0},r.not.undefined(e.location))){const t=(new m).IsLocationValid(e.location);if(r.not.truthy(t))throw new Error("Invalid location");i.location=e.location}i.time={nominal:{hour:12,minute:0},tolerance:{hour:0,minute:0}},r.not.undefined(i.astronomical_type)&&(i.time.astronomical_offset={type:"none",hour:0,minute:0,tolerance:{hour:0,minute:0}}),r.not.undefined(e.time)&&r.object(e.time)&&(r.not.undefined(i.astronomical_type)&&r.not.undefined(e.time.astronomical_offset)&&r.object(e.time.astronomical_offset)&&(r.not.undefined(e.time.astronomical_offset.type)&&r.string(e.time.astronomical_offset.type)&&(i.time.astronomical_offset.type=e.time.astronomical_offset.type),r.not.undefined(e.time.astronomical_offset.hour)&&r.number(e.time.astronomical_offset.hour)&&r.within(e.time.astronomical_offset.hour,-1,6)&&(i.time.astronomical_offset.hour=e.time.astronomical_offset.hour),r.not.undefined(e.time.astronomical_offset.minute)&&r.number(e.time.astronomical_offset.minute)&&r.within(e.time.astronomical_offset.minute,-1,60)&&(i.time.astronomical_offset.minute=e.time.astronomical_offset.minute)),r.not.undefined(e.time.nominal)&&r.object(e.time.nominal)&&(r.not.undefined(e.time.nominal.hour)&&r.number(e.time.nominal.hour)&&r.within(e.time.nominal.hour,-1,24)&&(i.time.nominal.hour=e.time.nominal.hour),r.not.undefined(e.time.nominal.minute)&&r.number(e.time.nominal.minute)&&r.within(e.time.nominal.minute,-1,60)&&(i.time.nominal.minute=e.time.nominal.minute)),r.not.undefined(e.time.tolerance)&&r.object(e.time.tolerance)&&(r.not.undefined(e.time.tolerance.hour)&&r.number(e.time.tolerance.hour)&&r.within(e.time.tolerance.hour,-1,24)&&(i.time.tolerance.hour=e.time.tolerance.hour),r.not.undefined(e.time.tolerance.minute)&&r.number(e.time.tolerance.minute)&&r.within(e.time.tolerance.minute,-1,60)&&(i.time.tolerance.minute=e.time.tolerance.minute)));break;default:throw new TypeError(`Configuration is invalid. Unknown TriggerType. ${e.trigger_type}`)}let o=null;switch(t){case y.TimedTrigger:o=new F(i);break;case y.ScheduledTrigger:o=new M(i);break;default:throw new TypeError(`Configuration is invalid. Unknown TriggerType. ${e.trigger_type}`)}this._triggers.set(o.Identifier,{accessory:null,trigger:o})}})),this._api.on("didFinishLaunching",this._bindDoInitialization),this._api.on("shutdown",this._bindDestructorNormal),process.on("exit",this._bindDestructorNormal),process.on("uncaughtException",this._bindDestructorAbnormal)}async _destructor(e,t){(e.exit||e.cleanup)&&(this._log.debug("Terminating the triggers."),this._log.debug(t),this._triggers.forEach(((e,t)=>{r.object(e)&&r.not.undefined(e.trigger)&&e.trigger instanceof F&&(this._log.debug(`Unsubscribing trigger: '${e.trigger.Identifier}'`),e.trigger.off(_,this._CB_TriggerStateChanged),e.trigger.off(b,this._CB_TriggerStateNotify))})))}async _doInitialization(){this._log(`Homebridge Plug-In ${z} has finished launching.`);const e=[];for(const t of this._triggers.values()){let n=!1;if(r.not.undefined(t.accessory)&&t.accessory instanceof V){const i=t.accessory;if(this._managePluginVersion(i)||(e.push(i),n=!0),!n){this._log.debug(`Checking to see if accessory '${i.displayName}' is an orphan.`);let t=!0;for(const e of this._triggers.values())if(Object.prototype.hasOwnProperty.call(i.context,"ID")&&r.existy(e.trigger)&&e.trigger instanceof F&&r.equal(e.trigger.Signature,i.context.ID)){t=!1;break}t&&(this._log.debug(`Accessory '${i.displayName}' is an orphan and should be purged.`),e.push(i))}}}e.forEach((e=>{this._removeAccessory(e)}));for(const e of this._triggers.values()){let t=e.accessory;if(r.existy(e.trigger)&&e.trigger instanceof F)r.not.existy(t)&&(t=this._addTriggerAccessory(e.trigger.Identifier)),e.trigger.on(_,this._CB_TriggerStateChanged),e.trigger.on(b,this._CB_TriggerStateNotify),this._getAccessorySwitchState(t)&&e.trigger.Start();else if(r.existy(t))throw this._log.debug(`Unexpected orphaned trigger '${t.displayName}.`),new RangeError("Orphaned accessory is found.")}}configureAccessory(e){if(r.undefined(e)||!(e instanceof V))throw new TypeError("accessory must be a PlatformAccessory");let t=!1;for(const n of this._triggers.values())if(r.not.undefined(n.accessory)&&n.accessory instanceof V&&n.accessory===e){t=!0;break}if(!t)try{this._configureAccessory(e,!1)}catch(t){this._log.debug(`Unable to configure accessory '${e.displayName}'. Version:${e.context.VERSION}. Error:${t}`),this._triggers.set(e.contect.ID,{accessory:e,trigger:null})}}_configureAccessory(e,t){if(r.undefined(e)||!(e instanceof V))throw new TypeError("accessory must be a PlatformAccessory");this._log.debug(`Configuring accessory ${e.displayName}'.`);const n=e.context.ID;t||e.on(V.PlatformAccessoryEvent.IDENTIFY,(()=>{this._log("%s identified!",e.displayName)}));let i=!0;const o=e.getService(G.Service.Switch);if(r.existy(o)&&o instanceof G.Service.Switch){const a=e.context.SETTINGS;if(void 0!==a&&r.object(a)&&Object.prototype.hasOwnProperty.call(a,"SwitchState")&&r.boolean(a.SwitchState)&&(i=a.SwitchState),o.updateCharacteristic(G.Characteristic.On,i),!t){const e=o.getCharacteristic(G.Characteristic.On);e.on("get",this._handleOnGet.bind(this,n)),e.on("set",this._handleOnSet.bind(this,n))}}const a=e.getService(G.Service.LightSensor);r.existy(a)&&a instanceof G.Service.LightSensor&&a.getCharacteristic(G.Characteristic.CurrentAmbientLightLevel).on("get",this._handleCurrentAmbientLightLevelGet.bind(this,n));const s=e.getService(G.Service.TimeInformation);r.existy(s)&&s instanceof G.Service.TimeInformation&&s.getCharacteristic(G.Characteristic.CurrentTime).on("get",this._handleCurrentTimeGet.bind(this,n));const c=[Z.CONTROL,Z.MOTION,Z.TIME_REMAINING,Z.DUE_TIME];for(const t of c){const n=e.getServiceById(t.uuid,t.udst);r.existy(n)&&n.updateCharacteristic(G.Characteristic.Name,`${t.name}-(${e.displayName})`)}try{const o=new Date;this._log.debug(`Updating services. Accessory(${e.displayName})`),this._updateMotionSensorService(e,Z.MOTION,{active:i,motion:!1}),this._updateLightSensorService(e,Z.TIME_REMAINING,{active:i,lightlevel:1e-4}),this._updateTimeInformationService(e,Z.DUE_TIME,{due_time:"Unknown",due_dow:o.getDay()+1}),this._updateAccessoryInfo(e,{model:"GrumpTech Time-Based Triggers",serialnum:n});let a=!1;this._triggers.forEach(((i,o)=>{r.existy(i.trigger)&&i.trigger instanceof F&&r.equal(i.trigger.Signature,n)&&(r.not.existy(i.accessory)||t)&&(a=!0,this._log.debug(`Adding accessory '${e.displayName}' to the triggers list. Count:${this._triggers.size}`),i.accessory=e)})),a||(this._log.debug(`Adding ORPHAN accessory '${e.displayName}' to the triggers list. Count:${this._triggers.size}`),this._triggers.set(n,{accessory:e,trigger:null}))}catch(t){this._log.debug(`Error configuring accessory '${e.displayName}'. Error:'${t}'`)}}_managePluginVersion(e){if(r.undefined(e)||!(e instanceof V))throw new TypeError("accessory must be a PlatformAccessory");let t=!1;if(Object.prototype.hasOwnProperty.call(e.context,"VERSION")&&r.number(e.context.VERSION)){const n=k-e.context.VERSION;if(r.not.negative(n)){let n=!1;r.equal(e.context.VERSION,k)?t=!0:r.equal(e.context.VERSION,1)?r.above(k,1)&&(this._log.debug(`Accessory '${e.displayName}' upgrading from v${e.context.VERSION} to v1.1`),e.addService(G.Service.TimeInformation,Z.DUE_TIME.uuid,Z.DUE_TIME.udst),e.addService(G.Service.LightSensor,Z.TIME_REMAINING.uuid,Z.TIME_REMAINING.udst),e.context.VERSION=k,n=!0,t=!0):this._log.debug(`Accessory '${e.displayName}' unsupported upgrade from v${e.context.VERSION} to v1.1`),t&&n&&(this._log.debug(`Reconfiguring accessory '${e.displayName}'`),this._configureAccessory(e,!0))}else this._log.debug(`Accessory '${e.displayName}' downgrading from v${e.context.VERSION} to v1.1`)}else this._log.debug(`Invalid accessory version for '${e.displayName}'. Version:'${e.context.VERSION}'`);return t}_addTriggerAccessory(e){if(r.not.string(e))throw new TypeError("id must be a string");if(e.length<=0)throw new RangeError("id must be a non-zero length string.");const t=this._triggers.get(e);if(r.not.existy(t))throw new Error(`'${e}' is not registered at all.`);if(r.not.existy(t.trigger))throw new Error(`Trigger Accessory '${e}' has no trigger.`);if(r.existy(t.accessory))throw new Error(`Trigger Accessory '${e}' is already registered.`);if(r.not.existy(t)||r.not.existy(t.trigger))throw new Error(`Trigger Accessory '${e}' has no trigger.`);this._log.debug(`Adding new accessory: id:'${e}'`);const n=G.uuid.generate(t.trigger.Signature),i=new V(t.trigger.Name,n);i.context.ID=t.trigger.Signature,i.context.VERSION=k,i.context.SETTINGS={SwitchState:!0},i.addService(G.Service.Switch,Z.CONTROL.uuid,Z.CONTROL.udst),i.addService(G.Service.MotionSensor,Z.MOTION.uuid,Z.MOTION.udst),i.addService(G.Service.TimeInformation,Z.DUE_TIME.uuid,Z.DUE_TIME.udst),i.addService(G.Service.LightSensor,Z.TIME_REMAINING.uuid,Z.TIME_REMAINING.udst);try{this._configureAccessory(i,!1)}catch(e){this._log.debug("Error when configuring accessory."),this._log.debug(e)}return this._api.registerPlatformAccessories(U,z,[i]),i}_removeAccessory(e){if(void 0===e||!(e instanceof V))throw new TypeError("Accessory must be a PlatformAccessory");let t=!1;if(this._triggers.forEach(((n,r)=>{t||n.accessory!==e||(t=!0)})),!t)throw new RangeError(`Accessory '${e.displayName}' is not registered.`);this._log.debug(`Removing accessory '${e.displayName}'`);const n=e.context.ID;e.removeAllListeners(V.PlatformAccessoryEvent.IDENTIFY);for(const t of e.services)if(t instanceof G.Service.Switch){const r=t.getCharacteristic(G.Characteristic.On);r.off("get",this._handleOnGet.bind(this,{accessory:e,service_id:n})),r.off("set",this._handleOnSet.bind(this,{accessory:e,service_id:n}))}else t instanceof G.Service.LightSensor?t.getCharacteristic(G.Characteristic.CurrentAmbientLightLevel).off("get",this._handleCurrentAmbientLightLevelGet.bind(this,n)):t instanceof G.Service.TimeInformation&&t.getCharacteristic(G.Characteristic.CurrentTime).off("get",this._handleCurrentTimeGet.bind(this,n));this._api.unregisterPlatformAccessories(U,z,[e]),t=!1,this._triggers.forEach(((n,r)=>{t||n.accessory!==e||(n.accessory=null,t=!0)}))}_updateAccessoryInfo(e,t){if(void 0===e||!(e instanceof V))throw new TypeError("Accessory must be a PlatformAccessory");if(void 0===t||!Object.prototype.hasOwnProperty.call(t,"model")||"string"!=typeof t.model||t.model instanceof Error||!Object.prototype.hasOwnProperty.call(t,"serialnum")||"string"!=typeof t.serialnum||t.serialnum instanceof Error)throw new TypeError("info must be an object with properties named 'model' and 'serialnum' that are either strings or Error");const n=e.getService(G.Service.AccessoryInformation);void 0!==n&&(n.updateCharacteristic(G.Characteristic.Manufacturer,"GrumpTech"),n.updateCharacteristic(G.Characteristic.Model,t.model),n.updateCharacteristic(G.Characteristic.SerialNumber,t.serialnum))}_updateMotionSensorService(e,t,n){if(r.not.existy(e)||!(e instanceof V))throw new TypeError("accessory must be a PlatformAccessory");if(r.not.existy(t)||r.not.object(t)||!Object.prototype.hasOwnProperty.call(t,"uuid")||r.not.string(t.uuid)||t.uuid.length<=0||!Object.prototype.hasOwnProperty.call(t,"name")||r.not.string(t.name)||t.name.length<=0||!Object.prototype.hasOwnProperty.call(t,"udst")||r.not.string(t.udst)||t.udst.length<=0)throw new TypeError("serviceName does not conform to a SERVICE_INFO item.");if(r.not.existy(n)||r.not.object(n)||!Object.prototype.hasOwnProperty.call(n,"active")||r.not.boolean(n.active)&&!(n.active instanceof Error)||!Object.prototype.hasOwnProperty.call(n,"motion")||r.not.boolean(n.motion)&&!(n.motion instanceof Error))throw new TypeError("values must be an object with properties named 'active' (boolean or Error) and 'motion' (boolean or Error)");const i=e.getServiceById(t.uuid,t.udst);if(r.existy(i)&&i instanceof G.Service.MotionSensor)try{i.updateCharacteristic(G.Characteristic.StatusActive,n.active),i.updateCharacteristic(G.Characteristic.MotionDetected,n.motion),i.updateCharacteristic(G.Characteristic.StatusFault,G.Characteristic.StatusFault.NO_FAULT),i.updateCharacteristic(G.Characteristic.StatusLowBattery,G.Characteristic.StatusLowBattery.BATTERY_LEVEL_NORMAL),i.updateCharacteristic(G.Characteristic.StatusTampered,G.Characteristic.StatusTampered.NOT_TAMPERED)}catch(t){this._log.debug(`Error setting characteristics for '${e.displayName}'. Error: ${t}`)}else this._log.debug(`No service: Accessory '${e.displayName}'`)}_updateTimeInformationService(e,t,n){if(r.not.existy(e)||!(e instanceof V))throw new TypeError("accessory must be a PlatformAccessory");if(r.not.existy(t)||r.not.object(t)||!Object.prototype.hasOwnProperty.call(t,"uuid")||r.not.string(t.uuid)||t.uuid.length<=0||!Object.prototype.hasOwnProperty.call(t,"name")||r.not.string(t.name)||t.name.length<=0||!Object.prototype.hasOwnProperty.call(t,"udst")||r.not.string(t.udst)||t.udst.length<=0)throw new TypeError("serviceName does not conform to a SERVICE_INFO item.");if(r.not.existy(n)||r.not.object(n)||!Object.prototype.hasOwnProperty.call(n,"due_time")||r.not.string(n.due_time)&&!(n.due_time instanceof Error)||!Object.prototype.hasOwnProperty.call(n,"due_dow")||r.not.number(n.due_dow)&&!(n.due_dow instanceof Error))throw new TypeError("values must be an object with properties named 'due_time' (string or Error) and 'due_dow' (number or Error)");const i=e.getServiceById(t.uuid,t.udst);if(r.existy(i)&&i instanceof G.Service.TimeInformation)try{i.updateCharacteristic(G.Characteristic.CurrentTime,n.due_time),i.updateCharacteristic(G.Characteristic.DayoftheWeek,n.due_dow),i.updateCharacteristic(G.Characteristic.TimeUpdate,!1)}catch(t){this._log.debug(`Error setting characteristics for '${e.displayName}'. Error: ${t}`)}else this._log.debug(`No service: Accessory '${e.displayName}'`)}_updateLightSensorService(e,t,n){if(r.not.existy(e)||!(e instanceof V))throw new TypeError("accessory must be a PlatformAccessory");if(r.not.existy(t)||r.not.object(t)||!Object.prototype.hasOwnProperty.call(t,"uuid")||r.not.string(t.uuid)||t.uuid.length<=0||!Object.prototype.hasOwnProperty.call(t,"name")||r.not.string(t.name)||t.name.length<=0||!Object.prototype.hasOwnProperty.call(t,"udst")||r.not.string(t.udst)||t.udst.length<=0)throw new TypeError("serviceName does not conform to a SERVICE_INFO item.");if(r.not.existy(n)||r.not.object(n)||!Object.prototype.hasOwnProperty.call(n,"active")||r.not.boolean(n.active)&&!(n.active instanceof Error)||!Object.prototype.hasOwnProperty.call(n,"lightlevel")||r.not.number(n.lightlevel)&&!(n.lightlevel instanceof Error))throw new TypeError("values must be an object with properties named 'lightlevel' (number or Error) and 'motion' (boolean or Error)");const i=e.getServiceById(t.uuid,t.udst);if(r.existy(i)&&i instanceof G.Service.LightSensor)try{i.updateCharacteristic(G.Characteristic.StatusActive,n.active),i.updateCharacteristic(G.Characteristic.CurrentAmbientLightLevel,n.lightlevel),i.updateCharacteristic(G.Characteristic.StatusFault,G.Characteristic.StatusFault.NO_FAULT),i.updateCharacteristic(G.Characteristic.StatusLowBattery,G.Characteristic.StatusLowBattery.BATTERY_LEVEL_NORMAL),i.updateCharacteristic(G.Characteristic.StatusTampered,G.Characteristic.StatusTampered.NOT_TAMPERED)}catch(t){this._log.debug(`Error setting characteristics for '${e.displayName}'. Error: ${t}`)}else this._log.debug(`No service: Accessory '${e.displayName}'`)}_handleOnGet(e,t){if(void 0===e||"string"!=typeof e||e.length<=0)throw new TypeError("id must be a non-zero length string.");let n=null,i=new Error(`id:${e} has no matching accessory`);this._triggers.forEach(((t,o)=>{if(r.existy(t.accessory)&&r.equal(t.accessory.context.ID,e)){const e=t.accessory;this._log.debug(`Trigger '${e.displayName}' Get Request.`);try{i=this._getAccessorySwitchState(e)}catch(t){this._log.debug(`  Unexpected error encountered: ${t.message}`),i=!1,n=new Error(`Accessory ${e.displayName} is not ressponding.`)}}})),t(n,i)}_handleOnSet(e,t,n){if(void 0===e||"string"!=typeof e||e.length<=0)throw new TypeError("id must be a non-zero length string.");this._log.debug(`Attempting to set trigger ${e} to ${t}`);let i=null;this._triggers.forEach(((n,o)=>{if(r.existy(n.accessory)&&r.equal(n.accessory.context.ID,e)){const o=n.accessory,a=r.existy(n.trigger);if(a){const e=o.context.SETTINGS;r.existy(e)&&r.object(e)&&Object.prototype.hasOwnProperty.call(e,"SwitchState")&&r.boolean(e.SwitchState)&&(e.SwitchState=t),o.context.SETTINGS=e}try{if(a){const e=n.trigger;t?e.Start():e.Stop()}else this._log.debug(`Accessory ID:${e} has no matching trigger.`),i=new Error(`id:${e} has no matching trigger.`)}catch(e){this._log.debug(`Unexpected error encountered: ${e.message}`),i=new Error(`Accessory ${o.displayName} is not ressponding.`)}}})),n(i)}_handleCurrentTimeGet(e,t){if(void 0===e||"string"!=typeof e||e.length<=0)throw new TypeError("id must be a non-zero length string.");let n=new Error(`id:${e} has no matching accessory`),i=!1;this._triggers.forEach(((t,o)=>{if(r.existy(t.accessory)&&r.equal(t.accessory.context.ID,e)){const o=t.accessory;this._log.debug(`Trigger '${o.displayName}' Get CurrentTime Request.`);try{if(r.existy(t.trigger)){const e=this._getNextDueTime(t.trigger);i=e.due_time,this._log.debug(`Trigger '${o.displayName}' Time=${i}.`)}else n=new Error(`id:${e} has no matching trigger`)}catch(e){this._log.debug(`  Unexpected error encountered: ${e.message}`),i=!1,n=new Error(`Accessory ${o.displayName} is not ressponding.`)}}})),t(n,i)}_handleCurrentAmbientLightLevelGet(e,t){if(void 0===e||"string"!=typeof e||e.length<=0)throw new TypeError("id must be a non-zero length string.");let n=null,i=new Error(`id:${e} has no matching accessory`);this._triggers.forEach(((t,o)=>{if(r.existy(t.accessory)&&r.equal(t.accessory.context.ID,e)){const o=t.accessory;this._log.debug(`Trigger '${o.displayName}' Get CurrentAmbientLightLevel Request.`);try{r.existy(t.trigger)?(i=this._getTimeRemaining(t.trigger),this._log.debug(`Trigger '${o.displayName}' TimeRemaining=${i}.`)):i=new Error(`id:${e} has no matching trigger`)}catch(e){this._log.debug(`  Unexpected error encountered: ${e.message}`),i=!1,n=new Error(`Accessory ${o.displayName} is not ressponding.`)}}})),t(n,i)}_getNextDueTime(e){if(r.not.existy(e)||!(e instanceof F))throw new TypeError("trigger must be a Time Trigger");const t=e.TimeRemaining,n=new Date(Date.now()+t);return{due_time:n.toString(),due_dow:n.getDay()+1}}_getTimeRemaining(e){const t=1e-4,n=1e5;if(r.not.existy(e)||!(e instanceof F))throw new TypeError("trigger must be a Time Trigger");let i=e.TimeRemaining;return i*=1/6e4,i<t?i=t:i>n&&(i=n),i}_getAccessorySwitchState(e){if(r.not.existy(e)||!(e instanceof V))throw new TypeError("Accessory must be a PlatformAccessory");let t=!1;const n=e.getService(G.Service.Switch);if(!r.existy(n))throw new Error(`Accessory ${e.displayName} does not have a Switch service.`);{const i=n.getCharacteristic(G.Characteristic.On);if(!r.existy(i))throw new Error(`The Switch service of accessory ${e.displayName} does not have an On charactristic.`);t=i.value}return t}_handleTriggerStateChanged(e){if(r.not.object(e)||r.undefined(e.uuid)||r.not.string(e.uuid)||r.undefined(e.new_state)||r.not.number(e.new_state)||r.undefined(e.old_state)||r.not.number(e.old_state))throw new TypeError("Invalid state changed event.");if(!this._triggers.has(e.uuid))throw this._log(`Unknown state change event. uuid:${e.uuid}`),new RangeError(`Unknown state change event. uuid:${e.uuid}`);const t=3===e.new_state,n=0!==e.new_state,i=this._triggers.get(e.uuid);if(r.existy(i)&&r.existy(i.accessory))try{this._log(`TriggerStateChanged: Updating motion status for trigger ${i.accessory.displayName}. active=${n} motion=${t}`),this._updateMotionSensorService(i.accessory,Z.MOTION,{active:n,motion:t});const e=this._getAccessorySwitchState(i.accessory);if(e!==n){const t=i.accessory.getService(G.Service.Switch);r.existy(t)&&t instanceof G.Service.Switch&&(this._log(`TriggerStateChanged: Updating switch status for trigger ${i.accessory.displayName} from ${e} to ${n}`),t.setCharacteristic(G.Characteristic.On,n))}if(r.existy(i.trigger)){const e=this._getTimeRemaining(i.trigger);this._log(`TriggerStateChanged: Updating time remaining for trigger ${i.accessory.displayName}. active=${n} timeRemaining=${e}`),this._updateLightSensorService(i.accessory,Z.TIME_REMAINING,{active:n,lightlevel:e});const t=this._getNextDueTime(i.trigger);this._log(`TriggerStateChanged: Updating due time for trigger ${i.accessory.displayName}. dueTime.time=${t.due_time} dueTime.dow=${t.due_dow}`),this._updateTimeInformationService(i.accessory,Z.DUE_TIME,t)}this._log("TriggerStateChanged: Update complete.")}catch{}else this._log(`TriggerStateChanged: Accessory for ${e.uuid} not found.`)}_handleTriggerStateNotify(e){if(r.not.object(e)||r.undefined(e.uuid)||r.not.string(e.uuid)||r.undefined(e.current_state)||r.not.number(e.current_state))throw new TypeError("Invalid state notify event.");if(!this._triggers.has(e.uuid))throw this._log(`Unknown state notify event. uuid:${e.uuid}`),new RangeError(`Unknown state notify event. uuid:${e.uuid}`);const t=3===e.current_state,n=0!==e.current_state,i=this._triggers.get(e.uuid);if(r.existy(i)&&r.existy(i.accessory)){try{if(this._log(`TriggerStateNotify: Updating motion status for trigger ${i.accessory.displayName}. active=${n} motion=${t}`),this._updateMotionSensorService(i.accessory,Z.MOTION,{active:n,motion:t}),r.existy(i.trigger)){const e=this._getTimeRemaining(i.trigger);this._log(`TriggerStateNotify: Updating time remaining for trigger ${i.accessory.displayName}. active=${n} timeRemaining=${e}`),this._updateLightSensorService(i.accessory,Z.TIME_REMAINING,{active:n,lightlevel:e});const t=this._getNextDueTime(i.trigger);this._log(`TriggerStateNotify: Updating due time for trigger ${i.accessory.displayName}. dueTime.time=${t.due_time} dueTime.dow=${t.due_dow}`),this._updateTimeInformationService(i.accessory,Z.DUE_TIME,t)}}catch{}this._log("TriggerStateNotify: Update complete.")}else this._log(`TriggerStateNotify: Accessory for ${e.uuid} not found.`)}}const B=e=>{if(P(`homebridge API version: v${e.version}`),V=e.platformAccessory,!Object.prototype.hasOwnProperty.call(V,"PlatformAccessoryEvent")){const e={IDENTIFY:"identify"};V.PlatformAccessoryEvent=e}G=e.hap,P(`Registering platform: ${z}`),e.registerPlatform(z,Y)}})();var a=o.Z;export{a as default};